# Guide: Setting Up and Running Your Python Backend

This document provides a step-by-step guide for generating, configuring, and running the Python backend for your Chartly application.

## Prerequisites

Before you begin, ensure you have the following installed on your system:
- **Python** (version 3.8 or newer recommended)
- **pip** (Python's package installer)
- A **Google Gemini API Key**. You can get one from [Google AI Studio](https://aistudio.google.com/app/apikey).

---

## Step 1: Generate the Backend Code

Your project contains a detailed prompt file specifically designed to instruct an AI assistant on how to build the required Python backend.

1.  Open the file `backend-prompt.md` in the project root.
2.  Copy the entire contents of this file.
3.  Go to your preferred AI assistant (like Google's Gemini, ChatGPT, or Claude).
4.  Paste the copied prompt and ask it to generate the Python code.
5.  The AI should provide you with two key pieces of code:
    *   The content for a `main.py` file (using the FastAPI framework).
    *   The content for a `requirements.txt` file (listing all necessary Python libraries).

---

## Step 2: Create the Backend Project Folder

It's best practice to keep your frontend and backend projects in separate folders.

1.  Outside of your current Next.js project directory, create a new folder for your backend. Let's call it `chartly-backend`.
2.  Inside this new `chartly-backend` folder, create two files:
    *   `main.py`
    *   `requirements.txt`
3.  Paste the code generated by the AI into the corresponding files.

Your folder structure should now look like this:
```
/your-workspace
  ├── /chartly-next-frontend  (Your current project)
  └── /chartly-backend
      ├── main.py
      └── requirements.txt
```

---

## Step 3: Set Up a Python Virtual Environment

Using a virtual environment prevents package conflicts between projects.

1.  Open your terminal or command prompt.
2.  Navigate into your backend folder:
    ```bash
    cd path/to/chartly-backend
    ```
3.  Create the virtual environment:
    ```bash
    python -m venv venv
    ```
4.  Activate it:
    *   **On macOS/Linux:** `source venv/bin/activate`
    *   **On Windows:** `.\venv\Scripts\activate`

    You'll know it's active when you see `(venv)` at the beginning of your terminal prompt.

---

## Step 4: Install Dependencies

Now, install the Python libraries required for the backend to run.

1.  Make sure your virtual environment is active.
2.  Run the following command in your terminal:
    ```bash
    pip install -r requirements.txt
    ```

---

## Step 5: Configure Your Gemini API Key

The backend needs your API key to make calls to the Gemini service.

1.  In the `chartly-backend` folder, create a new file named `.env`.
2.  Add your API key to this file like so:
    ```
    GEMINI_API_KEY="YOUR_GEMINI_API_KEY_HERE"
    ```
    Replace `"YOUR_GEMINI_API_KEY_HERE"` with your actual key.

---

## Step 6: Run the Python Backend Server

Your backend is now ready to run.

1.  With your virtual environment still active, run the following command from the `chartly-backend` directory:
    ```bash
    uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    ```
    *   `main:app` tells the `uvicorn` server to run the `app` object from your `main.py` file.
    *   `--reload` makes the server restart automatically when you make code changes.
2.  You should see output indicating the server is running, typically on `http://127.0.0.1:8000`.

---

## Step 7: Connect the Frontend to Your Live Backend

The final step is to tell the Next.js frontend to send requests to your running Python server instead of its local mock APIs.

1.  Navigate back to your Next.js project (`chartly-next-frontend`).
2.  Open the file at `src/app/api/charts/suggestions/route.ts`.
3.  **Replace the entire content** of this file with the following code. This code forwards the request to your Python backend.

    ```typescript
    import { NextResponse } from 'next/server';

    export async function POST(request: Request) {
      try {
        const body = await request.json();
        const pythonBackendUrl = 'http://127.0.0.1:8000/api/charts/suggestions';

        const response = await fetch(pythonBackendUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(body),
        });

        if (!response.ok) {
          const errorData = await response.text();
          throw new Error(`Backend error: ${response.status} ${errorData}`);
        }

        const data = await response.json();
        return NextResponse.json(data);

      } catch (error: any) {
        console.error('Failed to forward request to Python backend:', error);
        return NextResponse.json(
          { error: 'Failed to process chart suggestions.', details: error.message },
          { status: 500 }
        );
      }
    }
    ```

4.  Now, open the file at `src/app/api/insights/route.ts`.
5.  **Replace its content** with this code to forward insight requests:

    ```typescript
    import { NextResponse } from 'next/server';

    export async function POST(request: Request) {
      try {
        const body = await request.json();
        const pythonBackendUrl = 'http://127.0.0.1:8000/api/insights';

        const response = await fetch(pythonBackendUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(body),
        });

        if (!response.ok) {
          const errorData = await response.text();
          throw new Error(`Backend error: ${response.status} ${errorData}`);
        }
        
        const data = await response.json();
        return NextResponse.json(data);

      } catch (error: any) {
        console.error('Failed to forward request to Python backend:', error);
        return NextResponse.json(
          { error: 'Failed to generate AI insights.', details: error.message },
          { status: 500 }
        );
      }
    }
    ```

## You're All Set!

Your full-stack application is now running. Keep the Python `uvicorn` server running in one terminal and the Next.js `npm run dev` server running in another. When you upload a file in the Chartly app, the frontend will now make live API calls to your Python backend for chart suggestions and AI insights.